window.appAspro=window.appAspro||{},window.appAspro.phone||(window.appAspro.phone={get checkIntlPhone(){return"function"==typeof window.intlTelInput},get checkInputmask(){return"function"==typeof window.Inputmask},get checkIntlTelInputUtils(){return"function"==typeof window.intlTelInputUtils},errorMap:["INVALID_NUMBER","INVALID_COUNTRY_CODE","TOO_SHORT","TOO_LONG","INVALID_NUMBER","INVALID_NUMBER"],get config(){return this._config||""},set config(t){this._config=t},init:function(t,e){const n={useValidate:!0,mask:arAsproOptions.THEME.PHONE_MASK,onlyCountries:arAsproOptions.THEME.PHONE_CITIES,preferredCountries:arAsproOptions.THEME.PHONE_CITIES_FAVORITE};!e&&this.config&&(e=this.config),e=$.extend({},n,e||{}),this.checkIntlPhone?(e.coutriesData&&("undefined"==typeof allCountries?$.ajax({url:e.coutriesData,async:!1,success:function(t){allCountries&&(e.countries=allCountries)}}):e.countries=allCountries),this.initIntlPhone(t,e)):this.checkInputmask&&e.mask&&this.initNormalPhone(t,e)},initIntlPhone:function(t,e){let n={utilsScript:arAsproOptions.SITE_TEMPLATE_PATH+"/vendor/js/intl.phone/utils.js",preferredCountries:["ru"],autoPlaceholder:"aggressive",nationalMode:!1,onlyCountries:["ru"],formatOnDisplay:!0,autoHideDialCode:!0};e=e||{};const i=$.extend({},n,e);i.onlyCountries.length&&"string"==typeof i.onlyCountries&&(i.onlyCountries=i.onlyCountries.split(",")),i.preferredCountries.length&&"string"==typeof i.preferredCountries&&(i.preferredCountries=i.preferredCountries.split(","));t.each((function(t,e){let n=window.intlTelInput(e,i),o=$(e);o.data("iti",n),o.on("change",(function(){const t=o.val();if(!~t.indexOf("+")&&t.length&&o.val("+"+t),"undefined"!=typeof intlTelInputUtils){var e=n.getNumber(intlTelInputUtils.numberFormat.E164);"string"==typeof e&&n.setNumber(e)}n.getSelectedCountryData().name||(o.val(o.val().replace("+8","+7")),n.setNumber(o.val()))})),o.on("input",(function(t){const e=$(this),i=e.data("iti");let o=e.val();if(o.length>=1&&!o.includes("+")&&(e.val("+"+o),o=e.val()),o.length>3&&(i.getSelectedCountryData().name||e.val(o.replace("+8","+7"))),"undefined"!=typeof intlTelInputUtils){var r=n.getNumber(intlTelInputUtils.numberFormat.E164);"string"==typeof r&&n.setNumber(r)}})),o.on("keypress",(function(t){let e=String.fromCharCode(t.charCode?t.charCode:t.which);return""===t.target.value&&(t.target.value="+"),/\d/.test(e)})),o.trigger("change")})),this.bindPhoneMask(t),e.useValidate&&this.addValidationIntlPhone()},initNormalPhone:function(t,e){let n=e.mask.replace(/(\d)/g,"_");t.inputmask("mask",{mask:e.mask}),t.blur((function(){$(this).val()!=n&&""!=$(this).val()||$(this).hasClass("required")&&$(this).parent().find("label.error").html(BX.message("JS_REQUIRED"))})),e.useValidate&&this.addValidationPhone()},addValidationIntlPhone:function(){$.validator.addMethod("intl_phone",(function(t,e,n){let i=$(e).data("iti").isValidNumber();return e.classList.contains("required")||null!==e.getAttribute("required")?i?e.classList.remove("error"):e.classList.add("error"):i=!0,i}),(function(t,e){const n=$(e).data("iti");return BX.message(t[n.getValidationError()])||BX.message(t[0])})),$.validator.addClassRules({phone:{intl_phone:this.errorMap},phone_input:{intl_phone:this.errorMap}})},addValidationPhone:function(){arAsproOptions.THEME.VALIDATE_PHONE_MASK&&$.validator.addClassRules({phone:{regexp:arAsproOptions.THEME.VALIDATE_PHONE_MASK},phone_input:{regexp:arAsproOptions.THEME.VALIDATE_PHONE_MASK}})},bindPhoneMask:function(t){t.each((function(t,e){this.addEventListener("countrychange",(function(t){t.stopImmediatePropagation();const e=$(t.target);"object"==typeof t.detail&&t.detail&&"_selectListItem"===t.detail.type&&(e.trigger("input"),e.valid())}))}))}});